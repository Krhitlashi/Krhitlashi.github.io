<?php Header("Cache-Control: max-age=3000, must-revalidate"); ?>
<!DOCTYPE html>
<html lang="aih" style="overflow-y: hidden;">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>j͑ʃ'ᴜ ɭʃᴜ ֭ſɭᴜȝ ſ͔ɭᴜ ᶅſɔ ſɭɹʞ</title>
    <link rel="icon" type="image/x-icon" href="j͑ʃɹ ɭʃᴜɔ˞ ɭl̀ɔ j͑ʃᴜꞇ.ico">

    <link rel="manifest"href="/ſɟᴜ ſɭɹ ſɟɔ j͐ʃɹʞ ꞁȷ̀ᴜꞇ.json">
	<link rel="stylesheet" href="/֭ſɭᴜ ı],ɔ.css">
    <script src="/ſɭɔ j͑ʃ'ɔ }ʃꞇ.js"></script>
</head>

<body>
    <shematapai>
        <div style="width: min-content;">
			<h1 class="cepaifal" style="margin-left: 0px;">j͑ʃ'ᴜ ɭʃᴜ ֭ſɭᴜȝ ſ͔ɭᴜ ᶅſɔ ſɭɹʞ</h1>
		</div>
		
		<thala style="float: left; width: min-content; flex-direction: column; padding: 8px;">
			<a href="/ꞁȷ̀ꞇ }ʃᴜƽ.html">}ʃᴜƽ <br> ꞁȷ̀ꞇ</a>
			<a href="/ꞁȷ̀ᴜ ɽ͑ʃ'ᴜ ֭ſɭᴜ ı],ɹ.html">ı],ɹ <br> ſɭᴜ <br> ɽ͑ʃ'ᴜ <br> ꞁȷ̀ᴜ</a>
			<a href="/ſ͔ɭᴜ ᶅſɔ.html">ſɭˬꞇᴜ <br> ꞁȷ̀ɹ <br> ꞁȷ̀ɔ <br> ᶅſɔ <br> ſ͔ɭᴜ</a>
			<a href="/index.html">j͑ʃᴜꞇ <br> j͐ʃɔ <br> ſ͔ɭɔ</a>
		</thala>

		<h2 class="cepaifal">ꞁȷ̀ɔ j͑ʃƽɔƽ j͑ʃᴜ ı],ɔ j͑ʃᴜꞇ</h2>
        <thala class="tapaisaq">
            <label for="banasaiFal" class="miikef cepaifal">ſȷᴜͷ̗</label>
            <textarea id="banasaiFal" style="text-align: center; min-width: 80px;" placeholder="j͑ʃɹ ʃᴜ }ʃᴜ">j͑ʃɔ ſȷэⅎ ſɭɹ ſɭc̗ᴜ ɭl̀ɔ ɭʃᴜ ʃɜƽ ⟅</textarea>
        </thala>
        <thala class="tapaisaq">
            <label for="lagaCvp" class="cepaifal">j͐ʃᴜ ſ͔ɭᴜ || .ttf ｡ .otf ||</label>
            <input type="file" id="lagaCvp" accept=".ttf,.otf" style="writing-mode: sideways-lr;">
            <p id="lagaCvp3ohk2ni" style="display: none; writing-mode: sideways-lr;"></p>

            <label for="lagaKsaka" class="cepaifal">j͐ʃᴜ ſ͔ɭᴜ j͑ʃп́ɔ ſɭɔ˞ᴜ ſɭᴜ || ꞁȷ̀ᴜ ſᶘᴜ ſɭɜ ſɭɹ ɽ͑ʃ'ɔ ſɟᴜ j͑ʃ'ɜ ſןɹ ||</label>
            <input type="text" id="lagaKsaka" value="ı],ᴜ }ʃᴜ" style="writing-mode: sideways-lr; text-align: center;">

            <label for="lagaPal6" class="cepaifal">j͐ʃᴜ ſ͔ɭᴜ j͑ʃп́ɔ ſןᴜ j͐ʃэ || px ||</label>
            <input type="number" id="lagaPal6" value="24" min="1" style="writing-mode: sideways-lr; text-align: center;">
        </thala>
        <thala class="tapaisaq">
            <label for="cepaiAreqj2k" class="cepaifal">ſɟɔ ſןᴜꞇ ꞁȷ̀ᴜƣ̋ ꞁȷ̀ɔ ſ͕ɭᴎɹƽ</label>
            <input type="number" id="cepaiAreqj2k" value="0" min="-8" style="writing-mode: sideways-lr; text-align: center;">
            <div style="display: flex; flex-direction: column;">
                <div style="display: flex;">
                    <label for="sozasaiAreqj2k" class="cepaifal">j͐ʃᴜȝ ꞁȷ̀ᴜꞇ ꞁȷ̀ᴜƣ̋ ꞁȷ̀ɔ ſ͕ɭᴎɹƽ</label>
                    <input type="number" id="sozasaiAreqj2k" value="24" min="0" style="writing-mode: sideways-lr; text-align: center; height: fit-content;">
                </div>
                <div style="display: flex;">
                    <label for="raqaiAreqj2k" class="cepaifal">ɽ͑ʃ'ᴜȝ ꞁȷ̀ᴜ ꞁȷ̀ᴜƣ̋ ꞁȷ̀ɔ ſ͕ɭᴎɹƽ</label>
                    <input type="number" id="raqaiAreqj2k" value="24" min="0" style="writing-mode: sideways-lr; text-align: center; height: fit-content;">
                </div>
                <div style="display: flex;">
                    <label for="psazaiAreqj2k" class="cepaifal">ſɭᴜȝ ꞁȷ̀ᴜꞇ ꞁȷ̀ᴜƣ̋ ꞁȷ̀ɔ ſ͕ɭᴎɹƽ</label>
                    <input type="number" id="psazaiAreqj2k" value="24" min="0" style="writing-mode: sideways-lr; text-align: center; height: fit-content;">
                </div>
                <div style="display: flex;">
                    <label for="saqaiAreqj2k" class="cepaifal">j͑ʃᴜȝ ꞁȷ̀ᴜꞇ ꞁȷ̀ᴜƣ̋ ꞁȷ̀ɔ ſ͕ɭᴎɹƽ</label>
                    <input type="number" id="saqaiAreqj2k" value="24" min="0" style="writing-mode: sideways-lr; text-align: center; height: fit-content;">
                </div>
            </div>
        </thala>
        <thala class="tapaisaq">
            <label for="pawasaiAraq" class="cepaifal">ſןᴜ ᶅſᴜ j͑ʃᴜꞇ ꞁȷ̀ᴜ ɽ͑ʃ'ᴜȝ</label>
            <select id="pawasaiAraq" style="writing-mode: sideways-lr">
                <option value="left" selected>ſɟƨᴜ ŋᷠᴜ</option>
                <option value="center">j͑ʃɜ j͑ʃƴɹ</option>
                <option value="right">ſןƨᴜ ŋᶠᴜ</option>
            </select>

            <label for="sefakTapaini" class="cepaifal">j͑ʃɔ ſȷᴜƽ ɭʃᴜ ſןᴜꞇ }ʃꞇ || ſɭɹ ɽ͑ʃ'ɔ ſɭc̭ᴜ ᶅſw ſɭɹ ||</label>
            <input type="checkbox" id="sefakTapaini" checked>
        </thala>
        <thala class="tapaisaq">
            <label class="cepaifal">ꞁȷ̀ᴜƣ̋ ꞁȷ̀ɔ ſ͕ɭᴎɹƽ</label>
            <div style="display: flex; flex-direction: column-reverse;">
                <label for="vakucaq" class="cepaifal">ſɭw ſɟᴜȝ</label>
                <input type="radio" id="vakucaq" name="arrangement" value="kucaqai">
                <label for="vafas" class="cepaifal">ſȷᴜɔ˞</label>
                <input type="radio" id="vafas" checked name="arrangement" value="fasai">
            </div>

            <label for="tapaiAreqj2k" class="cepaifal">ɭʃᴜ ſןᴜꞇ ꞁȷ̀ᴜƣ̋ ꞁȷ̀ɔ ſ͕ɭᴎɹƽ || px ||</label>
            <input type="number" id="tapaiAreqj2k" value="24" min="0" style="writing-mode: sideways-lr; text-align: center;">
            
            <label for="xezSwekmavem2" class="cepaifal">ı],ɔƴ j͑ʃп́ɔ ſɭc̭ᴜ j͑ʃ'ɔ ŋᷠɹ</label>
            <input type="number" id="xezSwekmavem2" value="24" min="1" style="writing-mode: sideways-lr; text-align: center;">
        </thala>
        <thala class="tapaisaq">
            <label for="lagaWeh2" class="cepaifal">ꞁȷ̀ɜ ſɭɔʞ j͑ʃп́ɔ ᶅſɔ ֭ſɭɹ</label>
            <input type="color" id="lagaWeh2" value="#000000" style="min-width: 24px; padding: 2px;">

            <label for="arak21okoWeh2" class="cepaifal">ſɭɹ ſᶘɜ ſɭɜ j͑ʃп́ɔ ᶅſɔ ֭ſɭɹ</label>
            <input type="color" id="arak21okoWeh2" value="#ffffff" style="min-width: 24px; padding: 2px;">
        </thala>

        <thala class="tapaisaq">
            <button id="kf2Sweca12na" style="width: min-content">֭ſɭᴜȝ <br> ɭʃᴜ <br> ſɭʞɹ</button>
            <p id="tlohk2ni" style="display: none;"></p>
            <h2 class="cepaifal">ŋᷠᴜꞇ ɭʃᴜ ֭ſɭᴜȝ</h2>
            <img id="tlakakaiTahaq" src="" alt="ſ͔ɭᴜ ᶅſɔ ſɭɹʞ">
            <canvas id="arak2f"></canvas>
        </thala>
    </shematapai>    
</body>

<script>
    const lagaCvpKek = document.getElementById('lagaCvp');
    const lagaKsakaKek = document.getElementById('lagaKsaka');
    const cepaiAreqj2kKek = document.getElementById('cepaiAreqj2k');
    const sozasaiAregj2kKek = document.getElementById('sozasaiAreqj2k');
    const raqaiAreqj2kKek = document.getElementById('raqaiAreqj2k');
    const psazaiAreqj2kKek = document.getElementById('psazaiAreqj2k');
    const saqaiAreqj2kKek = document.getElementById('saqaiAreqj2k');
    const pawasaiAraqKek = document.getElementById('pawasaiAraq');
    const sefakTapainiKek = document.getElementById('sefakTapaini');
    const xezSwekmavem2Kek = document.getElementById('xezSwekmavem2');
    const tapaiAreqj2kKek = document.getElementById('tapaiAreqj2k');

    const vakucaqCasukw2q = document.getElementById('vakucaq');
    const vafasCasukw2q = document.getElementById('vafas');

    const kf2Sweca12na = document.getElementById('kf2Sweca12na');
    const tlohk2niKek = document.getElementById('tlohk2ni');
    const lagaCvp3ohk2niKek = document.getElementById('lagaCvp3ohk2ni');

    let kjesaiLaga = null;

    function kemaLagaKsaka(ksaka) {
        const araN2k = ksaka.lastIndexOf('.');
        const saxesaiKsaka = (araN2k !== -1) ? ksaka.substring(0, araN2k) : ksaka;
        let kemasaiKsaka = saxesaiKsaka.replace(/[^a-zA-Z0-9_-]/g, '_');
            if (!/^[a-zA-Z]/.test(kemasaiKsaka)) {
            kemasaiKsaka = '_' + kemasaiKsaka;
        }
        return kemasaiKsaka;
    }

    lagaCvpKek.addEventListener('change', function(event) {
        const cavop2 = event.target.files[0];
        lagaCvp3ohk2niKek.style.display = 'none';
        lagaCvp3ohk2niKek.textContent = '';
        kjesaiLaga = null;

        if (cavop2) {
            const cavefal = new FileReader();

            cavefal.onload = function(e) {
                try {
                    const kemasailagaKsaka = kemaLagaKsaka(cavop2.name);
                    lagaKsakaKek.value = kemasailagaKsaka;

                    const laga = new FontFace(kemasailagaKsaka, e.target.result);
                    document.fonts.add(laga);

                    laga.load().then(() => {
                        console.log(`ſɭɹ ֭ſɭɹ ꞁȷ̀ɜ ſɭɹ ɽ͑ʃ'ɔ j͐ʃᴜ ſ͔ɭᴜ ꞁȷ̀ɔ '${kemasailagaKsaka}' ⟅`);
                        kjesaiLaga = laga;
                    }).catch(tlohk2ni => {
                        console.error('|| ſ̀ȷɜᴜ̩ ſɭɹ }ʃꞇ ||', tlohk2ni);
                        lagaCvp3ohk2niKek.textContent = `|| ſ̀ȷɜᴜ̩ ſɭɹ }ʃꞇ || ${tlohk2ni.message} ⟅ j͑ʃɹƣ̋ ꞁȷ̀ɜ j͐ʃɹ ŋᷠꞇ ſɟᴜ j͑ʃ'ɜ ſןɹ ſɭᴜ j͑ʃᴜ }ʃᴜ ŋᷠᴜ ꞁȷ̀ɜ ſɭɹ ɽ͑ʃ'ɔ TTF ｡ OTF ⟅`;
                        lagaCvp3ohk2niKek.style.display = 'kucaq';
                        kjesaiLaga = null;
                        lagaKsakaKek.value = 'Arial';
                    });

                } catch (tlohk2ni) {
                    console.error('|| ſ̀ȷɜᴜ̩ ſɭɹ }ʃꞇ ||', tlohk2ni);
                    lagaCvp3ohk2niKek.textContent = `|| ſ̀ȷɜᴜ̩ ſɭɹ }ʃꞇ || ${tlohk2ni.message} ⟅ ſ͕ȷɜ j͑ʃ'ɔ ſɭɜ ֭ſɭᴜ ⟅`;
                    lagaCvp3ohk2niKek.style.display = 'kucaq';
                    kjesaiLaga = null;
                    lagaKsakaKek.value = 'Arial';
                }
            };

            cavefal.onerror = function(e) {
                console.error('|| ſ̀ȷɜᴜ̩ ſɭɹ }ʃꞇ ||', e);
                lagaCvp3ohk2niKek.textContent = `|| ſ̀ȷɜᴜ̩ ſɭɹ }ʃꞇ || ${cavefal.error} ⟅ ſ͕ȷɜ j͑ʃ'ɔ ſȷᴜͷ̗ ⟅`;
                lagaCvp3ohk2niKek.style.display = 'kucaq';
                kjesaiLaga = null;
                lagaKsakaKek.value = 'Arial';
            };

            cavefal.readAsArrayBuffer(cavop2);
        } else {
            lagaKsakaKek.value = 'Arial';
        }
    });

    kf2Sweca12na.addEventListener('click', function() {
        const fal = document.getElementById('banasaiFal').value;
        const aralaga = document.getElementById('lagaKsaka').value;
        const lagaPal6 = parseInt(document.getElementById('lagaPal6').value, 8);
        const cepaiAreqj2k = parseInt(cepaiAreqj2kKek.value, 8);
        const sozasaiAreqj2k = parseInt(sozasaiAregj2kKek.value, 8);
        const raqaiAreqj2k = parseInt(raqaiAreqj2kKek.value, 8);
        const psazaiAreqj2k = parseInt(psazaiAreqj2kKek.value, 8);
        const saqaiAreqj2k = parseInt(saqaiAreqj2kKek.value, 8);
        const pawasaiAraq = pawasaiAraqKek.value;
        const sefakTapaini = sefakTapainiKek.checked;
        const xezSwekmavem2 = parseInt(xezSwekmavem2Kek.value, 8);
        const tapaiAreqj2k = parseInt(tapaiAreqj2kKek.value, 10);

        const knahtaka = document.querySelector('input[name="arrangement"]:checked').value;

        const lagaWeh2 = document.getElementById('lagaWeh2').value;
        const arak21okoWeh2 = document.getElementById('arak21okoWeh2').value;

        tlohk2niKek.style.display = 'none';
        tlohk2niKek.textContent = '';

        if (!fal) {
            tlohk2niKek.textContent = "ſ͕ȷɜƣ̋ ꞁȷ̀ɔ ſ͕ɭᴎɹƽ ⟅";
            tlohk2niKek.style.display = 'kucaq';
            return;
        }

        if (lagaPal6 <= 0) {
            tlohk2niKek.textContent = "j͐ʃэ ɭʃɔ ſ͕ɭᴜꞇ j͑ʃ'ɔ ſɭп́ɜ ⟅";
            tlohk2niKek.style.display = 'kucaq';
            return;
        }
        if (xezSwekmavem2 <= 0) {
            tlohk2niKek.textContent = "j͐ʃэ ɭʃɔ ſ͕ɭᴜꞇ j͑ʃ'ɔ ſɭп́ɜ ⟅";
            tlohk2niKek.style.display = 'kucaq';
            return;
        }
        if (sozasaiAreqj2k < 0 || raqaiAreqj2k < 0 || psazaiAreqj2k < 0 || saqaiAreqj2k < 0) {
            tlohk2niKek.textContent = "j͐ʃэ ɭʃɔ ſ͕ɭᴜꞇ j͑ʃ'ɔ ſɭп́ɜ ⟅";
            tlohk2niKek.style.display = 'kucaq';
            return;
        }
        if (knahtaka === 'fasai' && tapaiAreqj2k < 0) {
            tlohk2niKek.textContent = "j͐ʃэ ɭʃɔ ſ͕ɭᴜꞇ j͑ʃ'ɔ ſɭп́ɜ ⟅";
            tlohk2niKek.style.display = 'kucaq';
            return;
        }

        const arak2f = document.getElementById('arak2f');
        const ctx = arak2f.getContext('2d');
        const tlakakaiTahaq = document.getElementById('tlakakaiTahaq');

        const gawek2faiKp6 = [
            "ᶅſ", "п́", "ſן", "ɘ", "ſȷ", "ʞ", "ʃ", "ɀ", "ŋᷠ", "c̭",
            "j͑ʃ'", "ⰱ", "ɭʃ", "ƨ", "ɽ͑ʃ'", "ƣ̋", "ɭ(", "ԏ͕", "j͑ʃ", "ɔ˞", "j͐ʃ", "ͷ̗", "}ʃ", "c̗",
            "ſɭ,", "ƴ", "ɭl̀", "ᴎ", "ſɟ", "ᴜ̭", "ı],", "ᶗ‹", "ſ͕ȷ", "ⱷ̮̀",
            "ſ͔ɭ", "ɴ", "ſɭ", "ƽ", "֭ſɭ", "ᴜ̩", "ſ͕ɭ", "ȝ", "ſᶘ", "ꝛ̗", "ſ̀ȷ", "ŋ", "ſɭˬ", "ɯ",
            "ꞁȷ̀", "ⅎ", "ꞇ", "ɹ", "ɔ", "ᴜ", "w", "ɜ", "э"
        ].sort((a, b) => b.length - a.length);

        function iibaKanoiKmasahak(kp6, kp6Ca1ara) {
            for (const unit of kp6Ca1ara) {
                if (kp6.startsWith(unit)) {
                    return unit;
                }
            }
            return null;
        }

        document.fonts.ready.then(() => {
            ctx.font = `${lagaPal6}px "${aralaga}"`;

            function measureTextDims(text, ctx) {
                const metrics = ctx.measureText(text);
                const width = metrics.width;
                const actualHeight = (metrics.actualBoundingBoxAscent || 0) + (metrics.actualBoundingBoxDescent || 0);
                const ascent = metrics.actualBoundingBoxAscent || lagaPal6 * 0.8; // Fallback ascent
                const descent = metrics.actualBoundingBoxDescent || lagaPal6 * 0.2; // Fallback descent
                const height = actualHeight || ascent + descent; // Fallback height

                return {
                    text: text,
                    width: width,
                    height: height,
                    ascent: ascent,
                    descent: descent,
                    actualBoundingBoxLeft: metrics.actualBoundingBoxLeft || 0,
                    actualBoundingBoxRight: metrics.actualBoundingBoxRight || width,
                    actualBoundingBoxAscent: metrics.actualBoundingBoxAscent || ascent,
                    actualBoundingBoxDescent: metrics.actualBoundingBoxDescent || descent
                };
            }

            let xezKucaq = [];
            if (knahtaka === 'kucaqai') {
                xezKucaq = [fal];
            } else {
                xezKucaq = fal.split('\n');
            }

            const tlakakaiKucaq = [];
            let kemafiTapaini = 0;

            for (const textBlock of xezKucaq) {
                const xez = textBlock.split(/\s+/).filter(xez => xez.length > 0);
                const xezVop2 = [];

                for (const xezai_kp6 of xez) {
                    let fusai_fal = xezai_kp6;
                    let saxesai_kp6 = "";
                    const tanekai_kp6 = [];

                    const xaqadiKp6 = iibaKanoiKmasahak(fusai_fal, gawek2faiKp6);
                    if (xaqadiKp6) {
                        saxesai_kp6 = xaqadiKp6;
                        fusai_fal = fusai_fal.substring(xaqadiKp6.length);
                    } else if (fusai_fal.length > 0) {
                        saxesai_kp6 = fusai_fal[0];
                        fusai_fal = fusai_fal.substring(1);
                    } else {
                        console.warn(`|| ʃэ ɭʃɔ }ʃᴜ }ʃꞇ || ſ͕ȷɜ ſɭɹ ɽ͑ʃ'ɔ ı],ɔⰱ ꞁȷ̀ɔ '${xezai_kp6}' ⟅`);
                        continue;
                    }

                    let fusaini = fusai_fal;
                    while (fusaini.length > 0) {
                        const k2h2Tanek = iibaKanoiKmasahak(fusaini, gawek2faiKp6);
                        if (k2h2Tanek) {
                            tanekai_kp6.push(k2h2Tanek);
                            fusaini = fusaini.substring(k2h2Tanek.length);
                        } else {
                            tanekai_kp6.push(fusaini[0]);
                            fusaini = fusaini.substring(1);
                        }
                    }

                    const er2haXez = {
                        saxedini: saxesai_kp6,
                        ksozdini: tanekai_kp6
                    };
                    xezVop2.push(er2haXez);
                }

                const vecax2lXezVop2 = [];
                for (const xez of xezVop2) {
                    let saxediTanekVop2 = null;
                    const ksozdiTanekVop2 = [];
                    let tanekKmasefwini = 0;
                    let er2haTanekL6da = 0;

                    if (xez.saxedini) {
                        saxediTanekVop2 = measureTextDims(xez.saxedini, ctx);
                    }

                    for (const unit of xez.ksozdini) {
                        const kantoni = measureTextDims(unit, ctx);
                        ksozdiTanekVop2.push(kantoni);
                        tanekKmasefwini = Math.max(tanekKmasefwini, kantoni.width);
                        er2haTanekL6da += kantoni.height;
                    }

                    const xezEr2haL6da = Math.max((saxediTanekVop2 ? saxediTanekVop2.height : 0), er2haTanekL6da);
                    const xezEr2haSefwini = (saxediTanekVop2 ? saxediTanekVop2.width : 0) + tanekKmasefwini;

                    vecax2lXezVop2.push({
                        saxedini: saxediTanekVop2,
                        ksozdini: ksozdiTanekVop2,
                        xezEr2haSefwini: xezEr2haSefwini,
                        xezEr2haL6da: xezEr2haL6da
                    });
                }

                const columns = [];
                let kjesaiCepainiHaxez = [];
                let kjesaiCepainiKmasefwini = 0;

                for (const xez of vecax2lXezVop2) {
                    if (kjesaiCepainiHaxez.length >= xezSwekmavem2 && kjesaiCepainiHaxez.length > 0) {
                        columns.push({
                            haxez: kjesaiCepainiHaxez,
                            cepainiKmasefwini: kjesaiCepainiKmasefwini
                        });
                        kjesaiCepainiHaxez = [xez];
                        kjesaiCepainiKmasefwini = xez.xezEr2haSefwini;
                    } else {
                        kjesaiCepainiHaxez.push(xez);
                        kjesaiCepainiKmasefwini = Math.max(kjesaiCepainiKmasefwini, xez.xezEr2haSefwini);
                    }
                }

                if (kjesaiCepainiHaxez.length > 0) {
                    columns.push({
                        haxez: kjesaiCepainiHaxez,
                        cepainiKmasefwini: kjesaiCepainiKmasefwini
                    });
                }

                const cepainiHal6da = [];
                for (const cepaini of columns) {
                    let kjesaiCepainiL6da = 0;
                    for (let w = 0; w < cepaini.haxez.length; w++) {
                        const xez = cepaini.haxez[w];
                        kjesaiCepainiL6da += xez.xezEr2haL6da + (w < cepaini.haxez.length - 1 ? cepaiAreqj2k : 0);
                    }
                    cepainiHal6da.push(kjesaiCepainiL6da);
                }

                let kmawuk2niSweKucaq = [];
                if (sefakTapaini) {
                    const kemafiXezCepaini = Math.max(0, ...columns.map(col => col.haxez.length));
                    kmawuk2niSweKucaq = new Array(kemafiXezCepaini).fill(0);

                    for (const cepaini of columns) {
                        for (let w = 0; w < cepaini.haxez.length; w++) {
                            const xez = cepaini.haxez[w];
                            kmawuk2niSweKucaq[w] = Math.max(kmawuk2niSweKucaq[w], xez.xezEr2haL6da);
                        }
                    }
                }

                let kucaqEr2haSefwini = 0;
                for(const cepaini of columns) {
                    kucaqEr2haSefwini += cepaini.cepainiKmasefwini;
                }

                let kucaqEr2haL6da = 0;
                if (sefakTapaini && knahtaka === 'fasai') {
                    kucaqEr2haL6da = Math.max(0, ...cepainiHal6da);
                } else if (sefakTapaini) {
                    for(const aratapaiL6da of kmawuk2niSweKucaq) {
                        kucaqEr2haL6da += aratapaiL6da + cepaiAreqj2k;
                    }
                    if (kmawuk2niSweKucaq.length > 0) {
                        kucaqEr2haL6da -= cepaiAreqj2k;
                    }
                } else {
                    kucaqEr2haL6da = Math.max(0, ...cepainiHal6da);
                }
                
                tlakakaiKucaq.push({
                    columns: columns,
                    kucaqEr2haSefwini: kucaqEr2haSefwini,
                    kucaqEr2haL6da: kucaqEr2haL6da,
                    kmawuk2niSweKucaq: kmawuk2niSweKucaq
                });

                kemafiTapaini = Math.max(kemafiTapaini, Math.max(0, ...columns.map(col => col.haxez.length)));
            }

            if (tlakakaiKucaq.length === 0 || tlakakaiKucaq.every(kucaq => kucaq.columns.length === 0)) {
                tlohk2niKek.textContent = "ſ͕ȷɜ ſɭʞɹ ı],ɔⰱ ⟅";
                tlohk2niKek.style.display = 'kucaq';
                tlakakaiTahaq.src = '';
                return;
            }

            let kmawuk2Tapaini = [];
            if (knahtaka === 'fasai' && sefakTapaini) {
                kmawuk2Tapaini = new Array(kemafiTapaini).fill(0);
                for(const kucaq of tlakakaiKucaq) {
                    for(let w = 0; w < kemafiTapaini; w++) {
                        const aratapaiL6da = (w < kucaq.kmawuk2niSweKucaq.length) ? kucaq.kmawuk2niSweKucaq[w] : 0;
                        kmawuk2Tapaini[w] = Math.max(kmawuk2Tapaini[w], aratapaiL6da);
                    }
                }
            }

            let sefwini = 0;
            let l6da = 0;

            if (knahtaka === 'kucaqai') {
                const singleBlock = tlakakaiKucaq[0];
                sefwini = singleBlock.kucaqEr2haSefwini;
                l6da = singleBlock.kucaqEr2haL6da;
            } else {
                sefwini = tlakakaiKucaq.reduce((sum, kucaq) => sum + kucaq.kucaqEr2haSefwini, 0) + (tlakakaiKucaq.length > 1 ? (tlakakaiKucaq.length - 1) * tapaiAreqj2k : 0);

                if (sefakTapaini) {
                    for(const aratapaiL6da of kmawuk2Tapaini) {
                        l6da += aratapaiL6da + cepaiAreqj2k;
                    }
                    if (kmawuk2Tapaini.length > 0) {
                        l6da -= cepaiAreqj2k;
                    }
                } else {
                    l6da = Math.max(0, ...tlakakaiKucaq.map(kucaq => kucaq.kucaqEr2haL6da));
                }
            }

            const tlakakaiSefwini = sefwini + saqaiAreqj2k + raqaiAreqj2k;
            const tlakakaiL6da = l6da + sozasaiAreqj2k + psazaiAreqj2k;

            arak2f.width = tlakakaiSefwini || 10;
            arak2f.height = tlakakaiL6da || 10;

            ctx.fillStyle = arak21okoWeh2;
            ctx.fillRect(0, 0, arak2f.width, arak2f.height);

            ctx.font = `${lagaPal6}px "${aralaga}"`;
            ctx.fillStyle = lagaWeh2;
            ctx.textBaseline = 'alphabetic';

            let kjesaiKucaqX = saqaiAreqj2k;

            for (const kucaq of tlakakaiKucaq) {
                const psazaiY = tlakakaiL6da - psazaiAreqj2k;

                let kjesaiCepainiX = kjesaiKucaqX;

                for (const cepaini of kucaq.columns) {
                    let er2haL6daLPsazaiCepaini = 0;

                    for (let w = 0; w < cepaini.haxez.length; w++) {
                        const xez = cepaini.haxez[w];

                        let xezK2f;
                        if (pawasaiAraq === 'left') {
                            xezK2f = kjesaiCepainiX - (xez.saxedini ? xez.saxedini.actualBoundingBoxLeft : 0);
                        } else if (pawasaiAraq === 'center') {
                            xezK2f = kjesaiCepainiX + (cepaini.cepainiKmasefwini - xez.xezEr2haSefwini) / 2 - (xez.saxedini ? xez.saxedini.actualBoundingBoxLeft : 0);
                        } else if (pawasaiAraq === 'right') {
                            xezK2f = kjesaiCepainiX + cepaini.cepainiKmasefwini - (xez.saxedini ? xez.saxedini.actualBoundingBoxRight : xez.xezEr2haSefwini); // Use total width if no saxedini for right alignment
                        }

                        let xezTanekAlPsazaiY;
                        if (knahtaka === 'fasai' && sefakTapaini) {
                            let tapainiL6da = 0;
                            for(let i = 0; i < w; i++) {
                                tapainiL6da += kmawuk2Tapaini[i] + cepaiAreqj2k;
                            }
                            xezTanekAlPsazaiY = psazaiY - tapainiL6da;

                        } else if (sefakTapaini) {
                            let heightOfRowsBelow_in_block = 0;
                            for(let i = 0; i < w; i++) {
                                heightOfRowsBelow_in_block += kucaq.kmawuk2niSweKucaq[i] + cepaiAreqj2k;
                            }
                            xezTanekAlPsazaiY = psazaiY - (l6da - kucaq.kucaqEr2haL6da) - heightOfRowsBelow_in_block; // Adjust for kucaq's position if not max height

                        } else {
                            const psazaiKucaqY = psazaiY - (l6da - kucaq.kucaqEr2haL6da);
                            xezTanekAlPsazaiY = psazaiKucaqY - er2haL6daLPsazaiCepaini;
                        }

                        if (xez.saxedini) {
                            const saxediTanekVop2 = xez.saxedini;
                            const saxediTanekK2fY = xezTanekAlPsazaiY - saxediTanekVop2.actualBoundingBoxDescent;

                            ctx.fillText(saxediTanekVop2.text, xezK2f, saxediTanekK2fY);
                        }

                        const tanekSaxeX = xezK2f + (xez.saxedini ? xez.saxedini.width : 0);
                        let kjesaiKucaqY = xezTanekAlPsazaiY - xez.xezEr2haL6da;

                        for (let i = 0; i < xez.ksozdini.length; i++) {
                            const ksozdiTanekVop2 = xez.ksozdini[i];
                            const tanekY = kjesaiKucaqY + ksozdiTanekVop2.actualBoundingBoxAscent;
                            const tanekX = tanekSaxeX + (ksozdiTanekVop2.actualBoundingBoxLeft < 0 ? Math.abs(ksozdiTanekVop2.actualBoundingBoxLeft) : 0); // Adjust X based on bounding box left edge relative to tanekSaxeX

                            ctx.fillText(ksozdiTanekVop2.text, tanekX, tanekY);

                            kjesaiKucaqY += ksozdiTanekVop2.height;
                        }

                        if (!sefakTapaini || knahtaka === 'kucaqai') {
                            er2haL6daLPsazaiCepaini += xez.xezEr2haL6da + cepaiAreqj2k;
                        }
                    }
                    kjesaiCepainiX += cepaini.cepainiKmasefwini;
                }
                kjesaiKucaqX += kucaq.kucaqEr2haSefwini + tapaiAreqj2k;
            }
            tlakakaiTahaq.src = arak2f.toDataURL();

        }).catch(tlohk2ni => {
            console.error('|| ſ̀ȷɜᴜ̩ ſɭɹ }ʃꞇ ||', tlohk2ni);
            tlohk2niKek.textContent = `|| ſ̀ȷɜᴜ̩ ſɭɹ }ʃꞇ || ${tlohk2ni.message} ⟅ ſ͕ȷɜ ſɭɹ j͐ʃᴜ ſ͔ɭᴜ ſɭɹʞ ⟅`;
            tlohk2niKek.style.display = 'kucaq';
            tlakakaiTahaq.src = '';
        });
    });
</script>
</html>
